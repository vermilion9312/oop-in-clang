/*
 * mode_mediator.c
 *
 *  Created on: Oct 20, 2025
 *      Author: LeeJooHo
 */


#include <mode_mediator.h>

static void stopwatch_operation(ModeMediatorPrivate* this)
{
	Input* button_2 = this->button_2;
	Input* button_3 = this->button_3;

	switch (this->state)
	{
	case STATE_STOPPED:
		if (button_2->is_released(button_2)) this->state = STATE_RUNNING;
		return;
	case STATE_RUNNING:
		if (button_2->is_released(button_2)) this->state = STATE_PAUSED;
		return;
	case STATE_PAUSED:
		if (button_2->is_released(button_2)) this->state = STATE_RUNNING;
		if (button_3->is_released(button_3)) this->state = STATE_STOPPED;
		return;
	default:
		return;
	}
}

static void update(ModeMediator* public)
{
	ModeMediatorPrivate* this = (ModeMediatorPrivate*) public;

	switch (this->mode)
	{
	case MODE_CLOCK:
		return;
	case MODE_TIMER:
		return;
	case MODE_STOPWATCH:
		stopwatch_operation(this);
		return;
	case MODE_ALARM:
		return;
	default:
		return;
	}
}

static ClockMode get_mode(ModeMediator* public)
{
	ModeMediatorPrivate* this = (ModeMediatorPrivate*) public;
	return this->mode;
}

static StopwatchState get_state(ModeMediator* public)
{
	ModeMediatorPrivate* this = (ModeMediatorPrivate*) public;
	return this->state;
}


ModeMediator* new_ModeMediator(Input* button_2, Input* button_3)
{
	ModeMediatorPrivate* this = malloc(sizeof(ModeMediatorPrivate));

	this->public.update    = update;
	this->public.get_mode  = get_mode;
	this->public.get_state = get_state;

	this->button_2 = button_2;
	this->button_3 = button_3;
	this->timer    = new_Timer((ModeMediator*) this);

	this->mode  = MODE_STOPWATCH;
	this->state = STATE_STOPPED;

	return (ModeMediator*) this;
}
