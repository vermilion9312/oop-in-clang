/*
 * seven_segment.c
 *
 *  Created on: Oct 13, 2025
 *      Author: vermi
 */


#include <seven_segment.h>

static void stopwatch_operation(SevenSegmentPrivate* this)
{
	ModeMediator* mediator = this->mediator;
	Timer*        timer    = this->timer;

	uint16_t count        = timer->get_count(timer);
	uint8_t  ones_digit   = (count / 1000) % 10;
	uint8_t  tenths_digit = (count /  100) % 10;

	switch (mediator->get_state(mediator))
	{
	case STATE_STOPPED:
		_7SEG_SetNumber(DGT1, ones_digit,   ON );
		_7SEG_SetNumber(DGT2, tenths_digit, OFF);
		return;
	case STATE_RUNNING:
		_7SEG_SetNumber(DGT1, ones_digit, (tenths_digit < 5) ? ON : OFF);
		_7SEG_SetNumber(DGT2, tenths_digit, OFF);
		return;
	case STATE_PAUSED:
		_7SEG_SetNumber(DGT1, ones_digit,   ON );
		_7SEG_SetNumber(DGT2, tenths_digit, OFF);
		return;
	default:
		return;
	}




}

static void operate(SevenSegment* public)
{
	SevenSegmentPrivate* this = (SevenSegmentPrivate*) public;
	ModeMediator* mediator = this->mediator;

	switch (mediator->get_mode(mediator))
	{
	case MODE_CLOCK:
		return;
	case MODE_TIMER:
		return;
	case MODE_STOPWATCH:
		stopwatch_operation(this);
		return;
	case MODE_ALARM:
		return;
	default:
		return;
	}
}

SevenSegment* new_SevenSegment(ModeMediator* mediator)
{
	SevenSegmentPrivate* this = malloc(sizeof(SevenSegmentPrivate));

	this->public.operate  = operate;
	this->mediator = mediator;
	this->timer = new_Timer(mediator);

	return (SevenSegment*) this;
}
